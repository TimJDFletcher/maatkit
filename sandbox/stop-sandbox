#!/bin/sh

err() {
   echo
   for msg; do
      echo $msg
   done
   echo "See http://code.google.com/p/maatkit/wiki/Testing for more information."
   echo
}

# ###########################################################################
# Sanity check the cmd line options.
# ###########################################################################
if [ $# -lt 1 ]; then
   err "Usage: stop-sandbox all|port [port...]"           \
       "The 'all' option stops sandboxes /tmp/123[0-9]*." \
       "The sandbox directorys are not removed."
   exit 1
fi

# ###########################################################################
# Stop the sandboxes.
# ###########################################################################

exit_status=0

ls /tmp/1234* >/dev/null 2>1
if [ $? -eq 0 ]; then
   for port in $@; do
      if [ "$port" = "all" ]; then
         for a in /tmp/123[0-9]*; do 
            $a/stop
            if [ $? -ne 0 ]; then
               exit_status=1
            fi
         done
         break
      fi

      if [ -d "/tmp/$port" ]; then
         /tmp/$port/stop
         if [ $? -ne 0 ]; then
            exit_status=1
         fi
      fi
   done
fi

exit $exit_status
